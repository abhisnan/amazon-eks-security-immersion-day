---
title : "Vulnerability Management for Containers"
weight : 22
---

## Amazon Elastic Container Registry

![ecr](/static/images/image-security/manage-image-cve-with-inspector/ecr.png)

An Amazon ECR private registry hosts your container images in a highly available and scalable architecture. You can use your private registry to manage private image repositories consisting of Docker and Open Container Initiative (OCI) images and artifacts. Each AWS account is provided with a default private Amazon ECR registry. ECR provides API operations to create, monitor, and delete image repositories and set permissions that control who can access them. ECR also integrates with the Docker CLI, so that you push and pull images from your development environments to your repositories.

### Basic scanning

Basic scanning allows manual scans and scan on push of images in this registry. This is the default setting for the private registry.


:::::tabs{variant="container"}

::::tab{id="cli" label="Using AWS CLI"}
Run the following command to see the vulnerabilities for the ECR the Repo `monolith-service:v1`

```bash
aws ecr describe-image-scan-findings \
    --repository-name monolith-service \
    --image-id imageTag=v1
```
The output will look like below. Please note the output is truncated.

```bash
{
    "imageScanFindings": {
        "enhancedFindings": [
            {
                "awsAccountId": "XXXXXXXXXXX",
                "description": " A vulnerability was found in systemd. This security flaw can cause a local information leak due to systemd-coredump not respecting the fs.suid_dumpable kernel setting.",
                "findingArn": "arn:aws:inspector2:us-west-2:XXXXXXXXXXX:finding/039a9a2cb5d45f436561abd4279c8b86",
                "firstObservedAt": "2023-03-10T08:15:51.367000+00:00",
                "lastObservedAt": "2023-03-10T08:15:51.367000+00:00",
                "packageVulnerabilityDetails": {
                    "cvss": [
                        {
                            "baseScore": 5.5,
                            "scoringVector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N",
                            "source": "NVD",
                            "version": "3.1"
                        }
                    ],
                    "referenceUrls": [
                        "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-4415"
                    ],
                    "relatedVulnerabilities": [],
                    "source": "UBUNTU_CVE",
                    "sourceUrl": "https://people.canonical.com/~ubuntu-security/cve/2022/CVE-2022-4415.html",
                    "vendorCreatedAt": "2023-01-11T15:15:00+00:00",
---
---                
```
::::

::::tab{id="console" label="Using AWS Console"}

1. Navigate to the [ECR repositories console](https://console.aws.amazon.com/ecr/repositories) and locate the repository you created during the environment setup steps.
2. Select the repository name (**monolith-service**). This will take you to the list of images pushed to the repository.
3. Review the image tagged `v1`. Since you had enabled Scan on push during the repository creation, the image has been scanned and findings based on vulnerabilities has been updated.
4. Under the `Vulnerabilities` column, select details. You will be directed to the scan overview. The scan overview shows the classification of vulnerabilities detected by the scan along with a description and the software package where the vulnerability was detected. Clicking on the name of the vulnerability takes you to the vulnerability details.

![ecrvuln](/static/images/image-security/manage-image-cve-with-inspector/ecrvuln.png)


::::

:::::



### Enhanced scanning

Enhanced scanning is a capability offered with Amazon Inspector which provides automated continuous scanning. Inspector identifies vulnerabilities in both operating system and programming language (such as Python, Java, Ruby etc.) packages in real time.

To work with enhanced scanning capability, you will need to enable Amazon Inspector.



:::::tabs{variant="container"}

::::tab{id="cli" label="Using AWS CLI"}

Run the following command to enable the Enhanced scanning in ECR Private registry. Please make a note of the `--rules` parameter which configures **CONTINUOUS_SCAN** and **SCAN_ON_PUSH** features and add filter for **monolith-service**.

```bash
aws ecr put-registry-scanning-configuration \
     --scan-type ENHANCED \
     --rules '[{"repositoryFilters" : [{"filter":"monolith-service","filterType" : "WILDCARD"}],"scanFrequency" : "CONTINUOUS_SCAN"},{"repositoryFilters" : [{"filter":"monolith-service","filterType" : "WILDCARD"}],"scanFrequency" : "SCAN_ON_PUSH"}]' \
     --region us-west-2
```
The output will look like below. Please note the output is truncated.

```bash
{
    "registryScanningConfiguration": {
        "scanType": "ENHANCED",
        "rules": [
            {
                "scanFrequency": "CONTINUOUS_SCAN",
                "repositoryFilters": [
                    {
                        "filter": "monolith-service",
                        "filterType": "WILDCARD"
                    }
                ]
            },
            {
                "scanFrequency": "SCAN_ON_PUSH",
                "repositoryFilters": [
                    {
                        "filter": "monolith-service",
                        "filterType": "WILDCARD"
                    }
                ]
            }
        ]
    }
}
```
::::

::::tab{id="console" label="Using AWS Console"}

1. Navigate to the [Amazon Inspector console](https://console.aws.amazon.com/inspector/v2/home).
2. Select **Get Started**, then select **Enable Inspector**.
3. To configure **Enhanced Scanning** with ECR, navigate to ECR console.
4. Select **Private registry** from the left navigation panel, then select **Edit** in the **Scanning configuration** section.
5. Select **Enhanced scanning** for **Scan type**.
6. Under `Continuous scanning filters`, enter **monolith-service** in the textbox and click on `Add filter`. Ensure the checkbox **Continuously scan all repositories** is unselected.
7. Under `Scan on push filters`, enter **monolith-service** in the textbox and click on `Add filter`. Ensure the checkbox **Scan on push all repositories** is unselected.
8. Select **Save**.

::::

:::::

The Enhanced scanning configuration looks like below in the [ECR Console](https://console.aws.amazon.com/ecr/private-registry/edit-scanning).

![enhanced-scanning](/static/images/image-security/manage-image-cve-with-inspector/enhanced-scanning.png)

::alert[Note that after Enhanced scanning is enabled in Amazon ECR, some times it make take up few minutes to reflect the findings in Amazon Inspector. Keep refreshing the All findings page in Amazon Inspector console.)]{header="Note"}

* Head back to the [Amazon Inspector console](https://console.aws.amazon.com/inspector/v2/home?region=us-west-2#/) and you will see scan results on the dashboard. You will see an environment summary which includes EC2 instances and container images.
* From the left navigation panel, select **Findings**, then select **All findings**.
* In the Findings filter, select **Repository name** from the filter dropdown, then enter **monolith-service** in the textbox and then click on Apply. This will list all vulnerabilities detected with the container image.
* Select the **Title** of the finding to load the finding's details.

![inspector cve](/static/images/image-security/manage-image-cve-with-inspector/inspector-cve.png)

* You can further review the **Inspector Score** in comparison with the **Common Vulnerability Scoring System (CVSS v3)** score.

![inspectorscore](/static/images/image-security/manage-image-cve-with-inspector/inspectorscore.png)
