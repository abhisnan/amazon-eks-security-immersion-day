---
title : "Build and Push Container images to an ECVR Repository"
weight : 21
---

::alert[Please ensure you are in the correct region for the tasks listed below. You can select the correct region from the region selection dropdown towards the top right of the AWS console.]{header="Note"}

For the purpose of this workshop, you will use Amazon Elastic Container Registry (Amazon ECR) to create a private repository for a sample open source container image.

You would not be focussing on getting the containerized application working, this section will focus on building an image, pushing the image to ECR and reviewing how to work with vulnerability scans.



1. Clone the sample application repository using the Cloud9 IDE.
```bash
git clone https://github.com/aws-samples/amazon-ecs-mythicalmysfits-workshop.git
```
2. After cloning the repository, you'll see that your project explorer now includes the files cloned.
```bash
cd amazon-ecs-mythicalmysfits-workshop/workshop-1
```
3. Navigate to the Dockerfile for workshop-1.
```bash
cd ~/environment/amazon-ecs-mythicalmysfits-workshop/workshop-1/app/monolith-service/
mv Dockerfile.draft Dockerfile
```
4. Update the contents of the Dockerfile with the following
```bash
FROM ubuntu:20.04
RUN apt-get update -y
RUN apt-get install -y python3-pip python-dev build-essential
RUN pip3 install --upgrade pip
COPY ./service/requirements.txt .
RUN pip3 install -r ./requirements.txt
COPY ./service /MythicalMysfitsService
WORKDIR /MythicalMysfitsService
EXPOSE 80
ENTRYPOINT ["python3"]
CMD ["mythicalMysfitsService.py"]
```
5. Build the container image.
```bash
docker build -t monolith-service .
```
After the build is complete, run docker images command. You should see the images just built.
![inspector-with-codepipeline](/static/images/image-security/manage-image-cve-with-inspector/dockerimages.png)

6. Navigate to the [ECR console](https://console.aws.amazon.com/ecr/home) 
, click on the left hand corner to expand the panel.


7. Click on **Repositories** in the left hand navigation panel and the select **Create repository**.

![ecr2](/static/images/image-security/manage-image-cve-with-inspector/ecr2.png)

8. In the **General settings**, under **Visibility settings**, select **Private**. give the repository name monolith-service and enable Tag immutability.

::alert[[Image tag mutability](https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-tag-mutability.html) You can configure a repository to enable tag immutability to prevent image tags from being overwritten. After the repository is configured for immutable tags, an ImageTagAlreadyExistsException error is returned if you attempt to push an image with a tag that is already in the repository. When tag immutability is enabled for a repository, this affects all tags and you cannot make some tags immutable while others are not.              This ensures that once an image tag is scanned for vulnerabilities, it cannot be overwritten by pushing the same tag with different contents.]{header="WARNING"  type="warning"}

![repocreate1](/static/images/image-security/manage-image-cve-with-inspector/repocreate1.png)

9. Under **Image scan settings**, enable **Scan on push**. Leave **Encryption settings** as default. Select **Create repository**



10. Once the repository is created you will see it listed in the **Repositories** console under **Private** repositories.

![repocreated](/static/images/image-security/manage-image-cve-with-inspector/repocreated.png)

11. Login to ECR by running the following command in the cloud9 IDE created for the workshop.
```bash
$(aws ecr get-login --no-include-email)
```
12. Run `docker images` and capture the `IMAGE ID` for the monolith-service container image. Tag and push the `monolith-service` to the ECR repository.

**Please ensure you replace `IMAGE ID`, `ACCOUNT_ID` and `REGION` with the details specific to your workshop environment.**

```bash
docker tag <IMAGE ID> <ACCOUNT_ID>.dkr.ecr.<REGION>.amazonaws.com/monolith-service:workshop
```

```bash
docker push <ACCOUNT_ID>.dkr.ecr.<REGION>.amazonaws.com/monolith-service:workshop
```
Once the image is pushed, you will see the tag in the `monolith-service` repository.
